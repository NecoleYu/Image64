<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Demo: Image64</title>
<style type="text/css">
canvas{
	border: 2px solid #ccc;
	padding: 2px;
}
</style>
</head>
<body>
<h1>Demo: Image64</h1>
<canvas id="canvas"></canvas>
<script type="text/javascript" src="image64.js"></script>
<script type="text/javascript">
var aticon=document.getElementById('canvas');

var ctx = aticon.getContext('2d');

ctx.font = "bold 26px Helvetica";  
ctx.fillStyle = "#000";
ctx.fillText("loading..", 10,100);
//document.body.appendChild(aticon);

var img = new Image64();

img.onload = function() {

	var width = img.width/3,
    	height = img.height/3;
	    aticon.setAttribute('width',width);
		aticon.setAttribute('height',height);
    	ctx.drawImage(img,0,0,width,height);
    	imgd = ctx.getImageData(0,0,width,height);
    	
    	var px = imgd.data;
		var total=width*height
		for(var i=0;i<total*4;i+=4){
			var xmono =parseInt( (0.2125 * px[i]) + (0.7154 * px[i+1]) + (0.0721 *px[i+2]), 10);
			px[i] = px[i+1] = px[i+2] = xmono;
		}
		ctx.putImageData(imgd,0,0);		

    	dataURL = aticon.toDataURL();
}

img.onerror = function(){
	alert("(T______T)!");
}

img.setSrc('http://aoao.github.com/Image64/demo.png');

</script>
</body>
</html>